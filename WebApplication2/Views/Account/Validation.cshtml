@{
    var err = TempData["CodeError"] as string;
    var last = TempData["LastCode"] as string;
}


<style>
  /* 에러 자리 고정 (플로팅 아래에 별도 슬롯) */
  .field-error {
    min-height: 18px;           /* 한 줄 높이 확보 */
    margin-top: 6px;
    font-size: 12px;
    color: #dc3545;              /* Bootstrap danger */
  }
  .field-error:empty::before { content: "\00a0"; } /* 비어도 높이 유지 */
</style>



<div class="card shadow-sm mx-auto" style="max-width:420px;">
    <div class="card-body p-4">
        <h3 class="mb-4 text-center">이메일 인증</h3>

        <div class="form-floating">
            @Html.AntiForgeryToken()
            <button id="sendBtn" class="btn btn-primary" type="button">인증코드 전송</button>
        </div>

            <form id="form-val" method="post" asp-controller="Account" asp-action="ValidateCode" novalidate>
                 @Html.AntiForgeryToken()

                  @if (!string.IsNullOrWhiteSpace(err))
                  {
                    <div class="field-error">@err</div>  <!-- 에러가 있을 때만 생김 -->
                  }

                  <div class="form-floating">
                     <input name="code" class="form-control" id="ValidationCode" value="@(last ?? "")" />
                    <label for="ValidationCode">인증코드 입력</label>
                  </div>

                      <button type="submit" class="btn btn-primary w-100 mt-2">코드인증</button>
    
      
        </form>
        
    </div>
</div>



@section Scripts {
  <partial name="_ValidationScriptsPartial" />
  <script>

    function togglePwd(){
      var el = document.getElementById('pwdInput');
      el.type = (el.type === 'password') ? 'text' : 'password';
    }


    document.getElementById('sendBtn').addEventListener('click', async () => {
    const token = document.querySelector('input[name="__RequestVerificationToken"]').value;
    await fetch('/Account/SendValMail', {
      method: 'POST',
      credentials: 'include',
      headers: { 'Content-Type': 'application/json', 'RequestVerificationToken': token },
      body: JSON.stringify({})
    });
  });
    

  </script>
}